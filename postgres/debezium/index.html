
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Welcome to Shaun's rabbit hole. This site serves as a personal knowledge base for me to record my thoughts and ideas. It is also a place for me to share my knowledge and experience with the world. I hope you find something useful here. ">
      
      
        <meta name="author" content="Eamon">
      
      
        <link rel="canonical" href="https://bodani.github.io/docs/postgres/debezium/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>利用debezium 实现数据变更捕获 - Tea</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#debezium" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tea" class="md-header__button md-logo" aria-label="Tea" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tea
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              利用debezium 实现数据变更捕获
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mysql/install/" class="md-tabs__link">
          
  
    
  
  MYSQL

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../install01/" class="md-tabs__link">
          
  
    
  
  POSTGRES

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../middleware/etcd/" class="md-tabs__link">
          
  
    
  
  中间件

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../yugabytedb/install/" class="md-tabs__link">
          
  
    
  
  YugabyteDB

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../thinking_in_db_fd/" class="md-tabs__link">
          
  
    
  
  数据库思考

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tea" class="md-nav__button md-logo" aria-label="Tea" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Tea
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    MYSQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            MYSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/PrivilegeManagement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    权限管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    高可用
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            高可用
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/MGR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    组复制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/myshellMGR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mysqlsh
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    压测
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            压测
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/mysqlslap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mysqlslap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://bodani.github.io/mysql45" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mysql45
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    POSTGRES
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            POSTGRES
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    安装维护
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            安装维护
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../replication01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    流复制
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    高可用
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            高可用
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ha_fd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    设计分析
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    索引篇
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            索引篇
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    索引类型及使用场景
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index-invalid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    索引失效
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hypopg-index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    假设索引
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    备份管理篇
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            备份管理篇
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logical-backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    逻辑备份
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../physical-backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    物理备份
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    数据管理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            数据管理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    删除
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pgstattuple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    表空间
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    中间件
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            中间件
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../middleware/etcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    etcd
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    YugabyteDB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            YugabyteDB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../yugabytedb/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../yugabytedb/deploy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    部署
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    数据库思考
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            数据库思考
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thinking_in_db_fd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    结构设计
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thinking_in_db_performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    性能优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thinking_in_db_tune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    模块调优
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#debezium" class="md-nav__link">
    <span class="md-ellipsis">
      debezium的几种使用方式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mysql-cdc" class="md-nav__link">
    <span class="md-ellipsis">
      mysql cdc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mysql cdc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topology" class="md-nav__link">
    <span class="md-ellipsis">
      Topology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      启动服务
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      访问源数据库
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-connect" class="md-nav__link">
    <span class="md-ellipsis">
      启动kafka connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql-source-connector" class="md-nav__link">
    <span class="md-ellipsis">
      注册 MySQL source connector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-events" class="md-nav__link">
    <span class="md-ellipsis">
      观察 change events
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgres-cdc" class="md-nav__link">
    <span class="md-ellipsis">
      postgres cdc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="postgres cdc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topology_1" class="md-nav__link">
    <span class="md-ellipsis">
      Topology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      配置文件准备
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      开始测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgres-sourcer-connetor" class="md-nav__link">
    <span class="md-ellipsis">
      postgres sourcer connetor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="postgres sourcer connetor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      配置管理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-testing-newer-connector-versions-unpack-the-connector-archive-into-this" class="md-nav__link">
    <span class="md-ellipsis">
      For testing newer connector versions, unpack the connector archive into this
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directory-and-uncomment-the-lines-below" class="md-nav__link">
    <span class="md-ellipsis">
      directory and uncomment the lines below
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    <span class="md-ellipsis">
      volumes:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-debezium-connector-postgreskafkaconnectdebezium-connector-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      - ./debezium-connector-postgres:/kafka/connect/debezium-connector-postgres
    </span>
  </a>
  
    <nav class="md-nav" aria-label="- ./debezium-connector-postgres:/kafka/connect/debezium-connector-postgres">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      开始测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      数据库验证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-sinker-connetor" class="md-nav__link">
    <span class="md-ellipsis">
      postgres sinker connetor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="postgres sinker connetor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#topology_2" class="md-nav__link">
    <span class="md-ellipsis">
      Topology
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-citus" class="md-nav__link">
    <span class="md-ellipsis">
      docker citus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      单张表
    </span>
  </a>
  
    <nav class="md-nav" aria-label="单张表">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sink-postgresjson" class="md-nav__link">
    <span class="md-ellipsis">
      配置 sink-postgres.json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sink" class="md-nav__link">
    <span class="md-ellipsis">
      注册 sink
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      多表
    </span>
  </a>
  
    <nav class="md-nav" aria-label="多表">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sink-postgres-alltablesjson" class="md-nav__link">
    <span class="md-ellipsis">
      配置 sink-postgres-alltables.json
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-connect-rest-api" class="md-nav__link">
    <span class="md-ellipsis">
      Kafka Connect REST API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kafka Connect REST API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connect" class="md-nav__link">
    <span class="md-ellipsis">
      获取 Connect 集群的基本信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kafka-connect-worker" class="md-nav__link">
    <span class="md-ellipsis">
      列出 Kafka Connect Worker 上安装的插件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      创建一个连接器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      获取所有现有的连接器名称
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      获取连接器的配置信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      获取连接器的状态信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      获取当前为连接器运行的任务列表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      获取任务的当前状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topics" class="md-nav__link">
    <span class="md-ellipsis">
      获取连接器使用的主题(topics)列表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topics_1" class="md-nav__link">
    <span class="md-ellipsis">
      清空连接器的活动主题(topics)列表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      暂停连接器任务
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      恢复连接器任务
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      删除连接器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      更新连接器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tasks" class="md-nav__link">
    <span class="md-ellipsis">
      重启连接器和任务(tasks)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p>整个实现以功能演示为目标，便于流程的梳理和理解。不适合正式生成环境使用。</p>
<h2 id="debezium">debezium的几种使用方式</h2>
<ul>
<li>单独部署 下游数据传输到cloud，官方目前不推荐</li>
<li>与kafka联合使用 下游数据传输到kafka</li>
<li>嵌入式 例如Flink使用的debezium作为数据的source connetor模块使用，将数据接入到Flink中</li>
</ul>
<p>这里使用与kafka联合使用的方式，将源端数据库中的数据及变更导入到kafka中，来提供下游使用。</p>
<h2 id="mysql-cdc">mysql cdc</h2>
<p>源端数据库为mysql， 利用Debezium 捕获mysql数据及变化，并实时导入到kafka中。</p>
<h3 id="topology">Topology</h3>
<pre><code>                   +-------------+
                   |             |
                   |    MySQL    |
                   |             |
                   +------+------+
                          |
                          |
                          |
          +---------------v------------------+
          |                                  |
          |           Kafka Connect          |
          |  (Debezium, JDBC connectors)     |
          |                                  |
          +---------------+------------------+
</code></pre>
<h3 id="_1">启动服务</h3>
<pre><code class="language-shell">-- 启动zk
docker run -it --rm --name zookeeper -p 2181:2181 -p 2888:2888 -p 3888:3888 quay.io/debezium/zookeeper:1.9

-- 启动kafka
docker run -it --rm --name kafka -p 9092:9092 --link zookeeper:zookeeper quay.io/debezium/kafka:1.9

-- 启动mysql
docker run -it --rm --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw quay.io/debezium/example-mysql:1.9
</code></pre>
<h3 id="_2">访问源数据库</h3>
<pre><code class="language-sql">-- 利用mysql client 登录mysql数据库
docker run -it --rm --name mysqlterm --link mysql --rm mysql:8.0 sh -c 'exec mysql -h&quot;$MYSQL_PORT_3306_TCP_ADDR&quot; -P&quot;$MYSQL_PORT_3306_TCP_PORT&quot; -uroot -p&quot;$MYSQL_ENV_MYSQL_ROOT_PASSWORD&quot;'
mysql&gt; use inventory;
mysql&gt; show tables;
+---------------------+
| Tables_in_inventory |
+---------------------+
| addresses           |
| customers           |
| geom                |
| orders              |
| products            |
| products_on_hand    |
+---------------------+
mysql&gt; SELECT * FROM customers;
+------+------------+-----------+-----------------------+
| id   | first_name | last_name | email                 |
+------+------------+-----------+-----------------------+
| 1001 | Sally      | Thomas    | sally.thomas@acme.com |
| 1002 | George     | Bailey    | gbailey@foobar.com    |
| 1003 | Edward     | Walker    | ed@walker.com         |
| 1004 | Anne       | Kretchmar | annek@noanswer.org    |
+------+------------+-----------+-----------------------+
4 rows in set (0.00 sec)
</code></pre>
<h3 id="kafka-connect">启动kafka connect</h3>
<pre><code class="language-shell">启动
docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql quay.io/debezium/connect:1.9
验证
curl -H &quot;Accept:application/json&quot; localhost:8083/
{&quot;version&quot;:&quot;3.2.0&quot;,&quot;commit&quot;:&quot;cb8625948210849f&quot;} 
</code></pre>
<h3 id="mysql-source-connector">注册 MySQL source connector</h3>
<pre><code class="language-shell">-- 注册
$ curl -i -X POST -H &quot;Accept:application/json&quot; -H &quot;Content-Type:application/json&quot; localhost:8083/connectors/ -d '{ &quot;name&quot;: &quot;inventory-connector&quot;, &quot;config&quot;: { &quot;connector.class&quot;: &quot;io.debezium.connector.mysql.MySqlConnector&quot;, &quot;tasks.max&quot;: &quot;1&quot;, &quot;database.hostname&quot;: &quot;mysql&quot;, &quot;database.port&quot;: &quot;3306&quot;, &quot;database.user&quot;: &quot;debezium&quot;, &quot;database.password&quot;: &quot;dbz&quot;, &quot;database.server.id&quot;: &quot;184054&quot;, &quot;database.server.name&quot;: &quot;dbserver1&quot;, &quot;database.include.list&quot;: &quot;inventory&quot;, &quot;database.history.kafka.bootstrap.servers&quot;: &quot;kafka:9092&quot;, &quot;database.history.kafka.topic&quot;: &quot;dbhistory.inventory&quot; } }'

-- 查看注册的connector 情况
$ curl -H &quot;Accept:application/json&quot; localhost:8083/connectors/
$ curl -H  &quot;Content-Type:application/json&quot; http://localhost:8083/connectors/inventory-connector | jq
$ curl -H  &quot;Content-Type:application/json&quot; http://localhost:8083/connectors/inventory-connector/status | jq
</code></pre>
<h3 id="change-events">观察 change events</h3>
<p>​       这里可以对mysql数据进行dml操作，实时观察数据变更捕获情况</p>
<pre><code class="language-shell">$ docker run -it --rm --name watcher --link zookeeper:zookeeper --link kafka:kafka quay.io/debezium/kafka:1.9 watch-topic -a -k dbserver1.inventory.customers
</code></pre>
<h2 id="postgres-cdc">postgres cdc</h2>
<p>源端数据库为postgres， 利用Debezium 捕获postgres数据及变化，并实时导入到kafka中。</p>
<h3 id="topology_1">Topology</h3>
<pre><code>                   +-------------+
                   |             |
                   |    MySQL    |
                   |             |
                   +------+------+
                          |
                          |
                          |
          +---------------v------------------+
          |                                  |
          |           Kafka Connect          |
          |  (Debezium, JDBC connectors)     |
          |                                  |
          +---------------+------------------+
</code></pre>
<h3 id="_3">配置文件准备</h3>
<p>这里利用docker-compose 一键启动所有服务</p>
<ul>
<li>docker-compost-postgres.yaml</li>
<li>register-postgres.json </li>
</ul>
<p>docker-compost-postgres.yaml</p>
<pre><code>version: '2'
services:
  zookeeper:
    image: quay.io/debezium/zookeeper:${DEBEZIUM_VERSION}
    ports:
     - 2181:2181
     - 2888:2888
     - 3888:3888
  kafka:
    image: quay.io/debezium/kafka:${DEBEZIUM_VERSION}
    ports:
     - 9092:9092
    links:
     - zookeeper
    environment:
     - ZOOKEEPER_CONNECT=zookeeper:2181
  postgres:
    image: quay.io/debezium/example-postgres:${DEBEZIUM_VERSION}
    ports:
     - 5432:5432
    environment:
     - POSTGRES_USER=postgres
     - POSTGRES_PASSWORD=postgres
  connect:
    image: quay.io/debezium/connect:${DEBEZIUM_VERSION}
    ports:
     - 8083:8083
    links:
     - kafka
#     - postgres
    environment:
     - BOOTSTRAP_SERVERS=kafka:9092
     - GROUP_ID=1
     - CONFIG_STORAGE_TOPIC=my_connect_configs
     - OFFSET_STORAGE_TOPIC=my_connect_offsets
     - STATUS_STORAGE_TOPIC=my_connect_statuses
# For testing newer connector versions, unpack the connector archive into this
# directory and uncomment the lines below
#    volumes:
#     - ./debezium-connector-postgres:/kafka/connect/debezium-connector-postgres
</code></pre>
<p>​      register-postgres.json</p>
<pre><code>{
    &quot;name&quot;: &quot;inventory-connector&quot;,
    &quot;config&quot;: {
        &quot;connector.class&quot;: &quot;io.debezium.connector.postgresql.PostgresConnector&quot;,
        &quot;tasks.max&quot;: &quot;1&quot;,
        &quot;database.hostname&quot;: &quot;postgres&quot;,
        &quot;database.port&quot;: &quot;5432&quot;,
        &quot;database.user&quot;: &quot;postgres&quot;,
        &quot;database.password&quot;: &quot;postgres&quot;,
        &quot;database.dbname&quot; : &quot;postgres&quot;,
        &quot;database.server.name&quot;: &quot;dbserver1&quot;,
        &quot;schema.include.list&quot;: &quot;inventory&quot;
    }
}
</code></pre>
<h3 id="_4">开始测试</h3>
<pre><code>export DEBEZIUM_VERSION=1.9
# 一键启动所有服务
docker-compose -f docker-compose-postgres.yaml up

# Start Postgres connector
curl -i -X POST -H &quot;Accept:application/json&quot; -H  &quot;Content-Type:application/json&quot; http://localhost:8083/connectors/ -d @register-postgres.json

# Consume messages from a Debezium topic
docker-compose -f docker-compose-postgres.yaml exec kafka /kafka/bin/kafka-console-consumer.sh \
    --bootstrap-server kafka:9092 \
    --from-beginning \
    --property print.key=true \
    --topic dbserver1.inventory.customers

# Modify records in the database via Postgres client
docker-compose -f docker-compose-postgres.yaml exec postgres env PGOPTIONS=&quot;--search_path=inventory&quot; bash -c 'psql -U $POSTGRES_USER postgres'

# Shut down the cluster
docker-compose -f docker-compose-postgres.yaml down

</code></pre>
<h2 id="postgres-sourcer-connetor">postgres sourcer connetor</h2>
<p>区别与官方提供的pg docker 镜像</p>
<p>​   官方中的pg镜像逻辑解码使用的是decoderbufs，wal2jon。对于pg版本10+ 更推荐使用 logical 。并利用pgoutput进行解析 </p>
<h3 id="_5">配置管理</h3>
<p>pg</p>
<pre><code>wal_level = logical
</code></pre>
<p>​      拥有repication 权限访问数据库的用户，这里使用超级用户postgres </p>
<p>docker-compose-postgres.yaml</p>
<p>加入kakfa-ui 访问IP:8080 </p>
<p>```
version: '2'
services:
  zookeeper:
    image: quay.io/debezium/zookeeper:${DEBEZIUM_VERSION}
    ports:
     - 2181:2181
     - 2888:2888
     - 3888:3888
  kafka:
    image: quay.io/debezium/kafka:${DEBEZIUM_VERSION}
    ports:
     - 9092:9092
    links:
     - zookeeper
    environment:
     - ZOOKEEPER_CONNECT=zookeeper:2181
  kafka-ui:
    image: provectuslabs/kafka-ui:latest 
    ports:
     - 8080:8080
    links:
     - kafka:kakfa
    environment:
     - KAFKA_CLUSTERS_0_NAME=mykafka
     - KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka:9092
  connect:
    image: quay.io/debezium/connect:${DEBEZIUM_VERSION}
    ports:
     - 8083:8083
    links:
     - kafka
    environment:
     - BOOTSTRAP_SERVERS=kafka:9092
     - GROUP_ID=1
     - CONFIG_STORAGE_TOPIC=my_connect_configs
     - OFFSET_STORAGE_TOPIC=my_connect_offsets
     - STATUS_STORAGE_TOPIC=my_connect_statuses</p>
<h1 id="for-testing-newer-connector-versions-unpack-the-connector-archive-into-this">For testing newer connector versions, unpack the connector archive into this</h1>
<h1 id="directory-and-uncomment-the-lines-below">directory and uncomment the lines below</h1>
<h1 id="volumes">volumes:</h1>
<h1 id="-debezium-connector-postgreskafkaconnectdebezium-connector-postgres">- ./debezium-connector-postgres:/kafka/connect/debezium-connector-postgres</h1>
<p>```</p>
<p>register-postgres.json</p>
<pre><code>{
    &quot;name&quot;: &quot;inventory-connector&quot;,
    &quot;config&quot;: {
        &quot;connector.class&quot;: &quot;io.debezium.connector.postgresql.PostgresConnector&quot;,
        &quot;database.hostname&quot;: &quot;postgres&quot;,
        &quot;database.port&quot;: &quot;5432&quot;,
        &quot;database.user&quot;: &quot;postgres&quot;,
        &quot;database.password&quot;: &quot;postgres&quot;,
        &quot;database.dbname&quot;: &quot;postgres&quot;,
        &quot;database.server.name&quot;: &quot;debezium&quot;,
        &quot;slot.name&quot;: &quot;inventory_slot&quot;,
        &quot;table.include.list&quot;: &quot;inventory.orders,inventory.products&quot;,
        &quot;publication.name&quot;: &quot;dbz_inventory_connector&quot;,
        &quot;publication.autocreate.mode&quot;: &quot;all_tables&quot;,
        &quot;plugin.name&quot;: &quot;pgoutput&quot;,  
            &quot;topic.creation.default.replication.factor&quot;: 3,
            &quot;topic.creation.default.partitions&quot;: 10,
            &quot;topic.creation.default.cleanup.policy&quot;: &quot;delete&quot;,
            &quot;topic.creation.default.compression.type&quot;: &quot;lz4&quot;
    }
}
</code></pre>
<p>配置文件说明</p>
<p>https://debezium.io/documentation/reference/1.9/connectors/postgresql.html#postgresql-required-configuration-properties</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>connector.class</td>
<td>connector的实现类，本文使用的是io.debezium.connector.postgresql.PostgresConnector，因为我们的数据库是PostgreSQL</td>
</tr>
<tr>
<td>database.hostname</td>
<td>数据库服务的IP或域名</td>
</tr>
<tr>
<td>database.port</td>
<td>数据库服务的端口</td>
</tr>
<tr>
<td>database.user</td>
<td>连接数据库的用户</td>
</tr>
<tr>
<td>database.password</td>
<td>连接数据库的密码</td>
</tr>
<tr>
<td>database.dbname</td>
<td>数据库名</td>
</tr>
<tr>
<td>database.server.name</td>
<td>每个被监控的表在Kafka都会对应一个topic，topic的命名规范是<code>&lt;database.server.name&gt;.&lt;schema&gt;.&lt;table&gt;</code></td>
</tr>
<tr>
<td>slot.name</td>
<td>PostgreSQL的复制槽(Replication Slot)名称</td>
</tr>
<tr>
<td>table.include.list</td>
<td>如果设置了table.include.list，即在该list中的表才会被Debezium监控</td>
</tr>
<tr>
<td>plugin.name</td>
<td>PostgreSQL服务端安装的解码插件名称，可以是decoderbufs, wal2json, wal2json_rds, wal2json_streaming, wal2json_rds_streaming 和  pgoutput。如果不指定该值，则默认使用decoderbufs。   本例子中使用了pgoutput，因为它是PostgreSQL 10+自带的解码器，而其他解码器都必须在PostgreSQL服务器安装插件。</td>
</tr>
<tr>
<td>publication.name</td>
<td>PostgreSQL端的WAL发布(publication)名称，每个Connector都应该在PostgreSQL有自己对应的publication，如果不指定该参数，那么publication的名称为dbz_publication</td>
</tr>
<tr>
<td>publication.autocreate.mode</td>
<td>该值在plugin.name设置为pgoutput才会有效。有以下三个值：  <strong>all_tables</strong> - debezium会检查publication是否存在，如果publication不存在，connector则使用脚本CREATE  PUBLICATION <publication_name> FOR ALL  TABLES创建publication，即该发布者会监控所有表的变更情况。  <strong>disabled</strong> - connector不会检查有无publication存在，如果publication不存在，则在创建connector会报错.  <strong>filtered</strong> - 与all_tables不同的是，debezium会根据connector的配置中的table.include.list生成生成创建publication的脚本： <code>CREATE PUBLICATION &lt;publication_name&gt; FOR TABLE &lt;tbl1, tbl2, tbl3&gt;</code>。例如，本例子中，“table.include.list"值为"inventory.orders,inventory.products”，则publication只会监控这两个表的变更情况。</td>
</tr>
</tbody>
</table>
<h3 id="_6">开始测试</h3>
<pre><code>export DEBEZIUM_VERSION=1.9
docker-compose -f docker-compose-postgres.yaml up

# Start Postgres connector
curl -i -X POST -H &quot;Accept:application/json&quot; -H  &quot;Content-Type:application/json&quot; http://localhost:8083/connectors/ -d @register-postgres.json

# Consume messages from a Debezium topic
docker-compose -f docker-compose-postgres.yaml exec kafka /kafka/bin/kafka-console-consumer.sh \
    --bootstrap-server kafka:9092 \
    --from-beginning \
    --property print.key=true \
    --topic dbserver1.inventory.orders
</code></pre>
<h3 id="_7">数据库验证</h3>
<pre><code>-- 数据库中执行
select * from pg_replication_slots where slot_name = 'inventory_slot';
   slot_name    |  plugin  | slot_type | datoid | database | temporary | active | active_pid | xmin | catalog_xmin | restart_lsn | confirmed_flush_lsn | wal_status | safe_wal_size | two_phase 
----------------+----------+-----------+--------+----------+-----------+--------+------------+------+--------------+-------------+---------------------+------------+---------------+-----------
 inventory_slot | pgoutput | logical   |  14486 | postgres | f         | t      |       3798 |      |          790 | 0/E7AAE90   | 0/E7AAEC8           | reserved   |               | f
(1 row)

select * from pg_publication;
  oid  |         pubname         | pubowner | puballtables | pubinsert | pubupdate | pubdelete | pubtruncate | pubviaroot 
-------+-------------------------+----------+--------------+-----------+-----------+-----------+-------------+------------
 49187 | dbz_inventory_connector |       10 | f            | t         | t         | t         | t           | f
(1 row)

</code></pre>
<h2 id="postgres-sinker-connetor">postgres sinker connetor</h2>
<h3 id="topology_2">Topology</h3>
<pre><code>                   +-------------+
                   |             |
                   |   Postgres  |
                   |             |
                   +------+------+
                          |
                          |
                          |
          +---------------v------------------+
          |                                  |
          |           Kafka Connect          |
          |  (Debezium, JDBC connectors)     |
          |                                  |
          +---------------+------------------+
                          |
                          |
                          |
                   +-------------+
                   |             |
                   |   Postgres  |
                   |    citus    |
                   +------+------+

</code></pre>
<h3 id="docker-citus">docker  citus</h3>
<pre><code># run PostgreSQL with Citus on port 5500
docker run -d --name citus -p 5500:5432 -e POSTGRES_PASSWORD=mypassword citusdata/citus

# connect using psql within the Docker container
docker exec -it citus psql -U postgres

# set user postgres password 111111
alter user postgres with encrypted password '111111';

# or, connect using local psql
psql -U postgres -d postgres -h localhost -p 5500
</code></pre>
<p>plugin 下载地址，下载后解压到connetor 文件目录下并重新启动kafka connetor</p>
<p>https://www.confluent.io/hub/</p>
<p>https://d1i4a15mxbxib1.cloudfront.net/api/plugins/confluentinc/kafka-connect-jdbc/versions/10.5.1/confluentinc-kafka-connect-jdbc-10.5.1.zip</p>
<h3 id="_8">单张表</h3>
<h4 id="sink-postgresjson">配置 sink-postgres.json</h4>
<pre><code>{
    &quot;name&quot;: &quot;test-jdbc-sink&quot;,
    &quot;config&quot;: {
        &quot;connector.class&quot;: &quot;io.confluent.connect.jdbc.JdbcSinkConnector&quot;,
        &quot;tasks.max&quot;: &quot;1&quot;,
        &quot;connection.url&quot;: &quot;jdbc:postgresql://10.10.2.13:5432/test?user=postgres&amp;password=111&quot;,
        &quot;connection.user&quot;:&quot;postgres&quot;,
        &quot;connection.password&quot;:&quot;1111&quot;,
        &quot;topics&quot;:&quot;debezium.public.tablename&quot;,
        &quot;dialect.name&quot;:&quot;PostgreSqlDatabaseDialect&quot;,
        &quot;table.name.format&quot;: &quot;public.tablename&quot;,
        &quot;auto.create&quot;:&quot;true&quot;,
        &quot;auto.evolve&quot;:&quot;true&quot;,
        &quot;insert.mode&quot;:&quot;upsert&quot;,
        &quot;transforms&quot;: &quot;unwrap&quot;,
        &quot;transforms.unwrap.type&quot;: &quot;io.debezium.transforms.ExtractNewRecordState&quot;,
        &quot;transforms.unwrap.drop.tombstones&quot;: &quot;false&quot;,
        &quot;pk.fields&quot;:&quot;id&quot;,
        &quot;pk.mode&quot;:&quot;record_key&quot;,
        &quot;delete.enabled&quot; : true
    }
}
</code></pre>
<p>说明:</p>
<pre><code>name : connector 名称
connector.xxx : sink 数据库连接信息
topics : kafka中的topic
dialect.name: 方言
table.name.format : sink 端与topic 对应的表名称。 表名默认为topic
auto.create : 是否自动建表
insert.mode : insert upsert update
delete.enabled： 默认false 不支持删除和更新
pk.fields ： 主键 
pk.mode ： 主键类型
</code></pre>
<p>更多选项请参考 https://docs.confluent.io/kafka-connect-jdbc/current/sink-connector/sink_config_options.html</p>
<h4 id="sink">注册 sink</h4>
<pre><code>curl -i -X POST -H &quot;Accept:application/json&quot; -H  &quot;Content-Type:application/json&quot; http://localhost:8083/connectors/ -d @sink-postgres.json
</code></pre>
<h3 id="_9">多表</h3>
<p>​       默认情况table.name.format 的值为 topics，</p>
<p>​        topics的名称为 source connection 中定义的database.server.name+schema+tablename</p>
<p>​       这样就会对source connection  在定义时有所要求。即下游的dbname 与 database.server.name 必须保持一致</p>
<p>​       否则在创建sink connection 时将会出现如下错误</p>
<p>​       <code>ERROR:  cross-database references are not implemented</code></p>
<p>通过如下方式解除这种非必要的绑定</p>
<p>​    自定义topics、  table.name.format 。映射源表与目标表之间的对应关系。好处是非常的灵活，弊端每个表之间的关系都需要定义。</p>
<p>如果是源表与目标表名称完全一致或存在某种规律，比方加个前缀等。可通过如下方法批量处理、非常适合将数据库从一个库导到另一个库中的场景。</p>
<p>source connetor 端不需要修改    、只需要在 sink connetor 端做如下定义。截取topic的前缀</p>
<h4 id="sink-postgres-alltablesjson">配置 sink-postgres-alltables.json</h4>
<pre><code class="language-json">{
    &quot;name&quot;: &quot;test-jdbc-sink-alltables&quot;,
    &quot;config&quot;: {
        &quot;connector.class&quot;: &quot;io.confluent.connect.jdbc.JdbcSinkConnector&quot;,
        &quot;tasks.max&quot;: &quot;1&quot;,
        &quot;connection.url&quot;: &quot;jdbc:postgresql://10.10.2.13:5432/test?user=postgres&amp;password=111&quot;,
        &quot;connection.user&quot;:&quot;postgres&quot;,
    &quot;connection.password&quot;:&quot;1111&quot;,
        &quot;topics.regex&quot;: &quot;dbserver1.public(.*)&quot;,
        &quot;transforms&quot;: &quot;dropPrefix,unwrap&quot;,
        &quot;transforms.dropPrefix.type&quot;:&quot;org.apache.kafka.connect.transforms.RegexRouter&quot;,
        &quot;transforms.dropPrefix.regex&quot;:&quot;dbserver1.public(.*)&quot;,
        &quot;transforms.dropPrefix.replacement&quot;:&quot;$1&quot;,
        &quot;transforms.unwrap.type&quot;: &quot;io.debezium.transforms.ExtractNewRecordState&quot;,
        &quot;transforms.unwrap.drop.tombstones&quot;: &quot;false&quot;,
        &quot;dialect.name&quot;:&quot;PostgreSqlDatabaseDialect&quot;,
        &quot;auto.create&quot;:&quot;true&quot;,
        &quot;insert.mode&quot;:&quot;upsert&quot;,
        &quot;pk.mode&quot;:&quot;record_key&quot;,
        &quot;delete.enabled&quot; : &quot;true&quot;
    }
}
</code></pre>
<h2 id="kafka-connect-rest-api">Kafka Connect REST API</h2>
<p>为了方便查看json 建议安装jq </p>
<p><code>yum install epel-release jq -y</code></p>
<p>官方文档</p>
<p>https://kafka.apache.org/documentation.html#connect_rest</p>
<h3 id="connect">获取 Connect 集群的基本信息</h3>
<pre><code class="language-sh">curl -s -X GET localhost:8083/ | jq
</code></pre>
<h3 id="kafka-connect-worker">列出 Kafka Connect Worker 上安装的插件</h3>
<pre><code class="language-sh"># curl -s -X GET localhost:8083/connector-plugins | jq
</code></pre>
<h3 id="_10">创建一个连接器</h3>
<pre><code class="language-sh">curl -i -X POST -H &quot;Accept:application/json&quot; -H &quot;Content-Type:application/json&quot; 192.168.0.40:8083/connectors/ -d @inventory-connector.json
</code></pre>
<h3 id="_11">获取所有现有的连接器名称</h3>
<pre><code class="language-sh"># curl -s -X GET localhost:8083/connectors/ | jq
</code></pre>
<h3 id="_12">获取连接器的配置信息</h3>
<pre><code class="language-sh"># curl -s -X GET localhost:8083/connectors/inventory-connector | jq
</code></pre>
<h3 id="_13">获取连接器的状态信息</h3>
<pre><code class="language-sh"># curl -s -X GET localhost:8083/connectors/inventory-connector/status | jq
</code></pre>
<h3 id="_14">获取当前为连接器运行的任务列表</h3>
<pre><code class="language-sh"># curl -s -X GET localhost:8083/connectors/inventory-connector/tasks | jq
</code></pre>
<h3 id="_15">获取任务的当前状态</h3>
<pre><code class="language-sh"># curl -s -X GET localhost:8083/connectors/inventory-connector/tasks/0/status | jq
</code></pre>
<h3 id="topics">获取连接器使用的主题(topics)列表</h3>
<pre><code class="language-sh"># curl -s -X GET localhost:8083/connectors/oracle-scott-connector/topics | jq
</code></pre>
<h3 id="topics_1">清空连接器的活动主题(topics)列表</h3>
<pre><code># curl -s -X PUT localhost:8083/connectors/oracle-scott-connector/topics/reset
</code></pre>
<h3 id="_16">暂停连接器任务</h3>
<pre><code># curl -s -X PUT localhost:8083/connectors/inventory-connector/pause
</code></pre>
<h3 id="_17">恢复连接器任务</h3>
<pre><code># curl -s -X PUT localhost:8083/connectors/inventory-connector/resume
</code></pre>
<h3 id="_18">删除连接器</h3>
<pre><code># curl -s -X DELETE localhost:8083/connectors/inventory-connector
</code></pre>
<h3 id="_19">更新连接器</h3>
<pre><code># curl -i -X PUT -H &quot;Accept:application/json&quot; -H &quot;Content-Type:application/json&quot; localhost:8083/connectors/inventory-connector/config -d @inventory-connector.json
</code></pre>
<h3 id="tasks">重启连接器和任务(tasks)</h3>
<ul>
<li>语法</li>
</ul>
<pre><code>POST /connectors/{name}/restart?includeTasks=&lt;true|false&gt;&amp;onlyFailed=&lt;true|false&gt;
# &quot;includeTasks=true&quot;: 重新启动连接器实例和任务实例
# &quot;includeTasks=false&quot;(默认): 仅重新启动连接器实例
# &quot;onlyFailed=true&quot;: 仅重新启动具有 FAILED 状态的实例
# &quot;onlyFailed=false&quot;(默认): 重新所有实例
</code></pre>
<ul>
<li>示例</li>
</ul>
<pre><code># curl -s -X POST localhost:8083/connectors/inventory-connector/restart
</code></pre>
<ul>
<li>默认只重新启动连接器并不会重新启动其所有任务。因此，您也可以重新启动失败的单个任务，然后再次获取其状态：</li>
</ul>
<pre><code># curl -s -X POST localhost:8083/connectors/inventory-connector/tasks/0/restart
# curl -s -X GET localhost:8083/connectors/inventory-connector/tasks/0/status | jq
</code></pre>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024  |   Eamon
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>