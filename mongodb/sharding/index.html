<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Welcome to Shaun's rabbit hole. This site serves as a personal knowledge base for me to record my thoughts and ideas. It is also a place for me to share my knowledge and experience with the world. I hope you find something useful here." name="description"/><meta content="Eamon" name="author"/><link href="https://bodani.github.io/docs/mongodb/sharding/" rel="canonical"/><link href="../replication/" rel="prev"/><link href="../privilege/" rel="next"/><link href="../../assets/images/favicon.png" rel="icon"/><meta content="mkdocs-1.5.3, mkdocs-material-9.5.3" name="generator"/><title>分片集群 - TeaLabs</title><link href="../../assets/stylesheets/main.50c56a3b.min.css" rel="stylesheet"/><link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../stylesheets/extra.css" rel="stylesheet"/><link href="../../custom-style/custom-styles.css" rel="stylesheet"/><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="indigo" data-md-color-primary="teal" data-md-color-scheme="slate" dir="ltr"> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#mongodb"> Skip to content </a> </div> <div data-md-component="announce"> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="TeaLabs" class="md-header__button md-logo" data-md-component="logo" href="../.." title="TeaLabs"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> TeaLabs </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> 分片集群 </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="teal" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"></path></svg> </label> <input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="deep_orange" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="green" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg> </label> <input aria-label="Switch to system preference" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="teal" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to system preference"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix=""> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> </nav> <nav aria-label="Tabs" class="md-tabs" data-md-component="tabs"> <div class="md-grid"> <ul class="md-tabs__list"> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../mysql/"> MYSQL </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../postgres/"> PostgreSQL </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a class="md-tabs__link" href="../../middleware/"> 中间件 </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../kubernetes/sts_update/"> 容器 </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../linux/"> Linux </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../postgres/maintenance/thinking_in_db_fd/"> 数据库思考 </a> </li> </ul> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="TeaLabs" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="TeaLabs"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> TeaLabs </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../mysql/"> <span class="md-ellipsis"> MYSQL </span> </a> <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex=""> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_1"> <span class="md-nav__icon md-icon"></span> MYSQL </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/install/"> <span class="md-ellipsis"> 安装 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/config/"> <span class="md-ellipsis"> 配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/PrivilegeManagement/"> <span class="md-ellipsis"> 权限管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/users/"> <span class="md-ellipsis"> 用户管理 </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_1_6" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../mysql/replication/"> <span class="md-ellipsis"> 主从复制 </span> </a> <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex=""> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="false" aria-labelledby="__nav_1_6_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_1_6"> <span class="md-nav__icon md-icon"></span> 主从复制 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/replication/replication/"> <span class="md-ellipsis"> 异步复制 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/replication/semisync/"> <span class="md-ellipsis"> 半同步复制 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_1_7" type="checkbox"/> <label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex=""> <span class="md-ellipsis"> 高可用 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_1_7_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_1_7"> <span class="md-nav__icon md-icon"></span> 高可用 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/MGR/"> <span class="md-ellipsis"> 组复制 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/myshellMGR/"> <span class="md-ellipsis"> mysqlsh </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_1_8" type="checkbox"/> <label class="md-nav__link" for="__nav_1_8" id="__nav_1_8_label" tabindex=""> <span class="md-ellipsis"> 监控 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_1_8_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_1_8"> <span class="md-nav__icon md-icon"></span> 监控 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/exporter/"> <span class="md-ellipsis"> exporter </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_1_9" type="checkbox"/> <label class="md-nav__link" for="__nav_1_9" id="__nav_1_9_label" tabindex=""> <span class="md-ellipsis"> 压测 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_1_9_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_1_9"> <span class="md-nav__icon md-icon"></span> 压测 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/mysqlslap/"> <span class="md-ellipsis"> mysqlslap </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="https://bodani.github.io/mysql45"> <span class="md-ellipsis"> mysql45 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../postgres/"> <span class="md-ellipsis"> PostgreSQL </span> </a> <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex=""> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> PostgreSQL </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/> <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex=""> <span class="md-ellipsis"> 安装与配置 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_2"> <span class="md-nav__icon md-icon"></span> 安装与配置 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/install01/"> <span class="md-ellipsis"> 安装 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/install02/"> <span class="md-ellipsis"> 安装详解 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/install/"> <span class="md-ellipsis"> 安装进阶 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/config/"> <span class="md-ellipsis"> 配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/> <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex=""> <span class="md-ellipsis"> 高可用 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_3"> <span class="md-nav__icon md-icon"></span> 高可用 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/ha/ha_fd/"> <span class="md-ellipsis"> 设计分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/ha/patroni/"> <span class="md-ellipsis"> Patroni集群 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/ha/patroni02/"> <span class="md-ellipsis"> Patroni高级 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/ha/pgautofailover/"> <span class="md-ellipsis"> PGAutofailover </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/ha/repmgr/"> <span class="md-ellipsis"> Repmgr </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/ha/repmgrd/"> <span class="md-ellipsis"> RepmgrD </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/ha/adlock/"> <span class="md-ellipsis"> 一致性 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../postgres/index/"> <span class="md-ellipsis"> 索引与查询优化 </span> </a> <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex=""> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_4"> <span class="md-nav__icon md-icon"></span> 索引与查询优化 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/index/index01/"> <span class="md-ellipsis"> 索引类型及使用场景 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/index/index-invalid/"> <span class="md-ellipsis"> 索引失效 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/index/index-bloom/"> <span class="md-ellipsis"> Bloom索引 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/index/hypopg-index/"> <span class="md-ellipsis"> 假设索引 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/index/partition/"> <span class="md-ellipsis"> 表分区 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/index/partman/"> <span class="md-ellipsis"> Partman插件 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/index/template/"> <span class="md-ellipsis"> 模板表 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/index/unlogged_table/"> <span class="md-ellipsis"> 未记录表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_5" type="checkbox"/> <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex=""> <span class="md-ellipsis"> 性能优化 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_5"> <span class="md-nav__icon md-icon"></span> 性能优化 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/fillfactor/"> <span class="md-ellipsis"> 填充因子 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/stat/"> <span class="md-ellipsis"> 统计信息 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/params/"> <span class="md-ellipsis"> 参数优化 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/high_level_sql/"> <span class="md-ellipsis"> 高级SQL </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/FunctionsandOperators/"> <span class="md-ellipsis"> 连接函数 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/vacuum/"> <span class="md-ellipsis"> VACUUM操作 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/vacuum_limit/"> <span class="md-ellipsis"> VACUUM限制 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/hotupdate/"> <span class="md-ellipsis"> 冻结机制 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/thinking_in_db_performance/"> <span class="md-ellipsis"> 性能优化思考 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/thinking_in_db_tune/"> <span class="md-ellipsis"> 系统调优 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_6" type="checkbox"/> <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex=""> <span class="md-ellipsis"> 数据维护 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_6_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_6"> <span class="md-nav__icon md-icon"></span> 数据维护 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/toast/"> <span class="md-ellipsis"> 事务管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/delete/"> <span class="md-ellipsis"> 数据删除 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/checkpoint/"> <span class="md-ellipsis"> 检查点 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/daily_management/"> <span class="md-ellipsis"> 日常管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/bgwriter/"> <span class="md-ellipsis"> BGWriter </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/tablespace/"> <span class="md-ellipsis"> 表空间 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/pgstattuple/"> <span class="md-ellipsis"> 空间工具 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_rewrite.md"> <span class="md-ellipsis"> 表迁移 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_pathman.md"> <span class="md-ellipsis"> pg_pathman </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/maintenance/partition/"> <span class="md-ellipsis"> 分区表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_7" type="checkbox"/> <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex=""> <span class="md-ellipsis"> 监控分析 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_7_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_7"> <span class="md-nav__icon md-icon"></span> 监控分析 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/monitor/"> <span class="md-ellipsis"> 监控基础 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/monitor-sql/"> <span class="md-ellipsis"> SQL监控 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/view_pg_stat_activity/"> <span class="md-ellipsis"> STAT视图 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/view_pg_stat_bgwriter/"> <span class="md-ellipsis"> 统计BGWriter </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/monitor_explain/"> <span class="md-ellipsis"> Explain分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_activity/"> <span class="md-ellipsis"> 活动视图 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/dba/"> <span class="md-ellipsis"> 数据库监控 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_8" type="checkbox"/> <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex=""> <span class="md-ellipsis"> 扩展模块 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_8_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_8"> <span class="md-nav__icon md-icon"></span> 扩展模块 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/citus01/"> <span class="md-ellipsis"> Citus分布式 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/citus11/"> <span class="md-ellipsis"> Citus高级 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/timescaledb/"> <span class="md-ellipsis"> TimescaleDB </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/pipelinedb01/"> <span class="md-ellipsis"> PipelineDB </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/pipelinedb02/"> <span class="md-ellipsis"> PipelineDB实战 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/pgpool2/"> <span class="md-ellipsis"> PGPool-II </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/pgbouncer/"> <span class="md-ellipsis"> PGBouncer </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/pg_rman/"> <span class="md-ellipsis"> PGBackRMAN </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/pg_fdw/"> <span class="md-ellipsis"> FDW外部表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_9" type="checkbox"/> <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex=""> <span class="md-ellipsis"> 数据同步 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_9_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_9"> <span class="md-nav__icon md-icon"></span> 数据同步 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/replication/replication01/"> <span class="md-ellipsis"> 流复制 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/replication/replication02/"> <span class="md-ellipsis"> 复制原理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/replication/logical-replication/"> <span class="md-ellipsis"> 逻辑复制 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/replication/logical-replication_failover/"> <span class="md-ellipsis"> 逻辑复制故障切换 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_rewind/"> <span class="md-ellipsis"> pg_rewind </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_10" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../postgres/backup/"> <span class="md-ellipsis"> 备份与恢复 </span> </a> <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex=""> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="false" aria-labelledby="__nav_2_10_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_10"> <span class="md-nav__icon md-icon"></span> 备份与恢复 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/backup/logical-backup/"> <span class="md-ellipsis"> 逻辑备份 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/backup/physical-backup/"> <span class="md-ellipsis"> 物理备份 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/backup/pgbackrest/"> <span class="md-ellipsis"> pgBackRest </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/backup/wal-g/"> <span class="md-ellipsis"> WAL-G备份 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/backup/pgcopydb/"> <span class="md-ellipsis"> pgcopydb迁移 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/backup/reback/"> <span class="md-ellipsis"> 数据恢复基础 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/backup/reback_supper_user/"> <span class="md-ellipsis"> 超级用户恢复 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/backup/pitr/"> <span class="md-ellipsis"> PITR备份恢复 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_11" type="checkbox"/> <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex=""> <span class="md-ellipsis"> 安全管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_11_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_11"> <span class="md-nav__icon md-icon"></span> 安全管理 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/security/role-manager/"> <span class="md-ellipsis"> 角色管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../mysql/PrivilegeManagement/"> <span class="md-ellipsis"> 权限管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/security/login_nopasswd/"> <span class="md-ellipsis"> 连接认证 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/security/ssl/"> <span class="md-ellipsis"> SSL安全 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/security/prepare/"> <span class="md-ellipsis"> 备用服务 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/security/readonly/"> <span class="md-ellipsis"> 只读 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_12" type="checkbox"/> <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex=""> <span class="md-ellipsis"> 高级特性 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_12_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_12"> <span class="md-nav__icon md-icon"></span> 高级特性 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/wal_lsn/"> <span class="md-ellipsis"> WAL操作详解 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/wal_size/"> <span class="md-ellipsis"> WAL配置大小 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/insert01/"> <span class="md-ellipsis"> 高级插入技巧 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/upset/"> <span class="md-ellipsis"> UPSERT </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/hll/"> <span class="md-ellipsis"> HLL统计 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/pg_json/"> <span class="md-ellipsis"> JSON处理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/pg_trgm/"> <span class="md-ellipsis"> TRGM相似搜索 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_13" type="checkbox"/> <label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex=""> <span class="md-ellipsis"> 数据库设计 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_13_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_13"> <span class="md-nav__icon md-icon"></span> 数据库设计 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/normal-form/"> <span class="md-ellipsis"> 范式理论 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/materialized/"> <span class="md-ellipsis"> 物化视图 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/design/extention/"> <span class="md-ellipsis"> 扩展功能 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_14" type="checkbox"/> <label class="md-nav__link" for="__nav_2_14" id="__nav_2_14_label" tabindex=""> <span class="md-ellipsis"> 工具集 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_14_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_14"> <span class="md-nav__icon md-icon"></span> 工具集 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pgbench/"> <span class="md-ellipsis"> pgbench压测 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_elk/"> <span class="md-ellipsis"> 集群扩展 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_prewarm/"> <span class="md-ellipsis"> 预加载缓存 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_buffercache/"> <span class="md-ellipsis"> 统计预缓存 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pgfincore/"> <span class="md-ellipsis"> 模糊查询 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/lock_wait/"> <span class="md-ellipsis"> 锁等待分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pgage/"> <span class="md-ellipsis"> 行数统计 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pgwatch2/"> <span class="md-ellipsis"> 监控系统 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_prewarm/"> <span class="md-ellipsis"> 数据预热 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_lock/"> <span class="md-ellipsis"> 读写分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/pgstattuple/"> <span class="md-ellipsis"> 表分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_citus/"> <span class="md-ellipsis"> CITUS扩展 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_15" type="checkbox"/> <label class="md-nav__link" for="__nav_2_15" id="__nav_2_15_label" tabindex=""> <span class="md-ellipsis"> 版本与历史 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_15_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_15"> <span class="md-nav__icon md-icon"></span> 版本与历史 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/postgres12/"> <span class="md-ellipsis"> 12版特性 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/postgresql-howto/"> <span class="md-ellipsis"> 使用指南 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/tpch/"> <span class="md-ellipsis"> TPC-H基准 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/maintenance/archive/"> <span class="md-ellipsis"> 备份归档 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/extentions/citus01/"> <span class="md-ellipsis"> 扩展目录 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/config/"> <span class="md-ellipsis"> 配置文件目录 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/monitor/"> <span class="md-ellipsis"> 监控目录 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_16" type="checkbox"/> <label class="md-nav__link" for="__nav_2_16" id="__nav_2_16_label" tabindex=""> <span class="md-ellipsis"> 架构与原理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_16_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_16"> <span class="md-nav__icon md-icon"></span> 架构与原理 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/install/cluster/"> <span class="md-ellipsis"> 数据库架构 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/troubleshooting/debezium/"> <span class="md-ellipsis"> 系统分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/troubleshooting/dts/"> <span class="md-ellipsis"> 迁移与DTS </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/troubleshooting/explain/"> <span class="md-ellipsis"> 系统锁定分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/troubleshooting/libpg/"> <span class="md-ellipsis"> 登录处理流程 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_rewrite.md"> <span class="md-ellipsis"> 功能分析 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_2_17" type="checkbox"/> <label class="md-nav__link" for="__nav_2_17" id="__nav_2_17_label" tabindex=""> <span class="md-ellipsis"> 故障排除与问题解决 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_2_17_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_2_17"> <span class="md-nav__icon md-icon"></span> 故障排除与问题解决 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/troubleshooting/oom/"> <span class="md-ellipsis"> OOM问题 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/troubleshooting/auto_vacuum_trigger/"> <span class="md-ellipsis"> 空间自动清理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/tools/pg_prewarm/"> <span class="md-ellipsis"> 数据预加载 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/troubleshooting/awsome-postgres/"> <span class="md-ellipsis"> 案例研究 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../middleware/"> <span class="md-ellipsis"> 中间件 </span> </a> <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex=""> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_3"> <span class="md-nav__icon md-icon"></span> 中间件 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_3_2" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../clickhouse/install/"> <span class="md-ellipsis"> ClickHouse </span> </a> <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex=""> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_3_2"> <span class="md-nav__icon md-icon"></span> ClickHouse </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../clickhouse/install/install_single/"> <span class="md-ellipsis"> 单机版 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../clickhouse/install/install_cluster/"> <span class="md-ellipsis"> 集群版 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../clickhouse/ch-keeper/"> <span class="md-ellipsis"> keeper </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../clickhouse/demo/"> <span class="md-ellipsis"> 表引擎 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../clickhouse/compresstion/"> <span class="md-ellipsis"> 压缩 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../clickhouse/restore/"> <span class="md-ellipsis"> 恢复 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/> <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex=""> <span class="md-ellipsis"> MongoDB </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="true" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_3_3"> <span class="md-nav__icon md-icon"></span> MongoDB </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../install/"> <span class="md-ellipsis"> 安装 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../config/"> <span class="md-ellipsis"> 配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../replication/"> <span class="md-ellipsis"> 副本集 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> 分片集群 </span> <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> 分片集群 </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#_1"> <span class="md-ellipsis"> 概述 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_2"> <span class="md-ellipsis"> 架构组件 </span> </a> <nav aria-label="架构组件" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_3"> <span class="md-ellipsis"> 数据流图 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_4"> <span class="md-ellipsis"> 构建分片集群 </span> </a> <nav aria-label="构建分片集群" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_5"> <span class="md-ellipsis"> 单机构建最小实验环境 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_6"> <span class="md-ellipsis"> 端口规划 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_7"> <span class="md-ellipsis"> 配置文件 </span> </a> <nav aria-label="配置文件" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_8"> <span class="md-ellipsis"> 配置服务器配置文件 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#shardsvr"> <span class="md-ellipsis"> 分片副本集 (shardsvr) 配置文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_9"> <span class="md-ellipsis"> 目录规划 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_10"> <span class="md-ellipsis"> 通信认证文件 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_11"> <span class="md-ellipsis"> 启动服务并初始化 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#mongos"> <span class="md-ellipsis"> mongos </span> </a> <nav aria-label="mongos" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_12"> <span class="md-ellipsis"> 配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_13"> <span class="md-ellipsis"> 启动 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#mongos_1"> <span class="md-ellipsis"> 通过mongos配置集群 </span> </a> <nav aria-label="通过mongos配置集群" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_14"> <span class="md-ellipsis"> 配置分片集群 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_15"> <span class="md-ellipsis"> 启用数据库分片 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_16"> <span class="md-ellipsis"> 验证 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_17"> <span class="md-ellipsis"> 应用连接分片集群 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_18"> <span class="md-ellipsis"> 分片策略 </span> </a> <nav aria-label="分片策略" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_19"> <span class="md-ellipsis"> 块范围分片 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#hash"> <span class="md-ellipsis"> Hash 分片 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#zone"> <span class="md-ellipsis"> Zone 分片 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_20"> <span class="md-ellipsis"> 分片键选择 </span> </a> <nav aria-label="分片键选择" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_21"> <span class="md-ellipsis"> 好的分片键特征 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_22"> <span class="md-ellipsis"> 复合分片键 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_23"> <span class="md-ellipsis"> 管理分片集群 </span> </a> <nav aria-label="管理分片集群" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_24"> <span class="md-ellipsis"> 检查分片状态 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_25"> <span class="md-ellipsis"> 增加分片 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_26"> <span class="md-ellipsis"> 监控与调优 </span> </a> <nav aria-label="监控与调优" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_27"> <span class="md-ellipsis"> 关键指标 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_28"> <span class="md-ellipsis"> 分片操作查询 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_29"> <span class="md-ellipsis"> 注意事项 </span> </a> <nav aria-label="注意事项" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_30"> <span class="md-ellipsis"> 分区倾斜解决方法 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_31"> <span class="md-ellipsis"> 限制说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_32"> <span class="md-ellipsis"> 最佳实践 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../privilege/"> <span class="md-ellipsis"> 权限管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../backup_restore/"> <span class="md-ellipsis"> 备份恢复 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_3_4" type="checkbox"/> <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex=""> <span class="md-ellipsis"> 监控系统 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_3_4"> <span class="md-nav__icon md-icon"></span> 监控系统 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../monitor/prometheus/"> <span class="md-ellipsis"> Prometheus </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../monitor/grafana/"> <span class="md-ellipsis"> Grafana </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../monitor/exporter/"> <span class="md-ellipsis"> exporter </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../monitor/metrics/"> <span class="md-ellipsis"> 监控指标 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_3_5" type="checkbox"/> <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex=""> <span class="md-ellipsis"> fluentbit </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_3_5_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_3_5"> <span class="md-nav__icon md-icon"></span> fluentbit </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../fluentbit/intro/"> <span class="md-ellipsis"> 介绍 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../fluentbit/problems/"> <span class="md-ellipsis"> 问题排查 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/> <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex=""> <span class="md-ellipsis"> 容器 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> 容器 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../kubernetes/sts_update/"> <span class="md-ellipsis"> sts 滚动更新 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../../linux/"> <span class="md-ellipsis"> Linux </span> </a> <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex=""> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_2" type="checkbox"/> <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex=""> <span class="md-ellipsis"> 基础工具与系统管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_2"> <span class="md-nav__icon md-icon"></span> 基础工具与系统管理 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/tools/"> <span class="md-ellipsis"> 系统工具 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/process-comm/"> <span class="md-ellipsis"> 进程管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/sysstat/"> <span class="md-ellipsis"> 性能监控 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/meminfo/"> <span class="md-ellipsis"> 内存管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/hard_store/"> <span class="md-ellipsis"> 磁盘管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/findhidpid/"> <span class="md-ellipsis"> 文件系统工具 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/time-cmd/"> <span class="md-ellipsis"> 时间管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/mail/"> <span class="md-ellipsis"> 邮件管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cpu_temp/"> <span class="md-ellipsis"> 电源管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/syslog/"> <span class="md-ellipsis"> 系统日志 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_3" type="checkbox"/> <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex=""> <span class="md-ellipsis"> 命令详解与实用工具 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_3"> <span class="md-nav__icon md-icon"></span> 命令详解与实用工具 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cmd-awk/"> <span class="md-ellipsis"> awk命令详解 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cmd-gpasswd/"> <span class="md-ellipsis"> gpasswd命令 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cmd-sed/"> <span class="md-ellipsis"> sed命令详解 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cmd-vim/"> <span class="md-ellipsis"> vim命令使用 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cmd-xargs/"> <span class="md-ellipsis"> xargs命令使用 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/fu-cmd/"> <span class="md-ellipsis"> 其他常用命令 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/install-cmd/"> <span class="md-ellipsis"> 系统安装相关命令 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cmd-pstack/"> <span class="md-ellipsis"> 安装相关脚本工具 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_4" type="checkbox"/> <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex=""> <span class="md-ellipsis"> 虚拟化与容器技术 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_4_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_4"> <span class="md-nav__icon md-icon"></span> 虚拟化与容器技术 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/kvm01/"> <span class="md-ellipsis"> KVM 虚拟化 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/kuberctl/"> <span class="md-ellipsis"> K8s 管理工具 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/wind-run/"> <span class="md-ellipsis"> 容器网络管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_5" type="checkbox"/> <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex=""> <span class="md-ellipsis"> 硬件与驱动管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_5_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_5"> <span class="md-nav__icon md-icon"></span> 硬件与驱动管理 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/smartctl/"> <span class="md-ellipsis"> 硬件监控 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/dmidecode/"> <span class="md-ellipsis"> 硬件信息查询 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/mdadm/"> <span class="md-ellipsis"> 磁盘阵列管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/hdparm/"> <span class="md-ellipsis"> 硬盘性能检测 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/ipmitool/"> <span class="md-ellipsis"> 远程硬件管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cpu_utilize/"> <span class="md-ellipsis"> CPU温度与利用率 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_6" type="checkbox"/> <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex=""> <span class="md-ellipsis"> 安全与权限管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_6_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_6"> <span class="md-nav__icon md-icon"></span> 安全与权限管理 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/webmanage/"> <span class="md-ellipsis"> 系统安全管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/nice/"> <span class="md-ellipsis"> 用户权限管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/wheel/"> <span class="md-ellipsis"> 临时用户组 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/no-passwd/"> <span class="md-ellipsis"> 免密登录配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/bmcpasswd/"> <span class="md-ellipsis"> sudo配置与BMC </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/git-nopassword/"> <span class="md-ellipsis"> Git免密配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/resetpasswd-centos7/"> <span class="md-ellipsis"> 账户密码重置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/at-crontab/"> <span class="md-ellipsis"> 任务调度管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/terminal-reuse/"> <span class="md-ellipsis"> 终端会话复用 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/ln-s/"> <span class="md-ellipsis"> SSH免密与连接 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/openvpn/"> <span class="md-ellipsis"> 安全VPN管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_7" type="checkbox"/> <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex=""> <span class="md-ellipsis"> 系统配置与调优 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_7_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_7"> <span class="md-nav__icon md-icon"></span> 系统配置与调优 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/linux_tunning/"> <span class="md-ellipsis"> 系统参数调整 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cpu-affinity/"> <span class="md-ellipsis"> 进程优先级与CPU亲和性 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/kworker/"> <span class="md-ellipsis"> 内核后台进程 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/qos/"> <span class="md-ellipsis"> 网络QoS管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/init-centos/"> <span class="md-ellipsis"> 系统启动优化 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/ubuntu2004-network/"> <span class="md-ellipsis"> 网络配置Ubuntu </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/memtester/"> <span class="md-ellipsis"> 系统内存大页 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/ssdiotimeout/"> <span class="md-ellipsis"> I/O超时处理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/backlog-config/"> <span class="md-ellipsis"> Backlog队列管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_8" type="checkbox"/> <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex=""> <span class="md-ellipsis"> 存储与文件系统管理 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_8_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_8"> <span class="md-nav__icon md-icon"></span> 存储与文件系统管理 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/lvm/"> <span class="md-ellipsis"> LVM存储管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/parted/"> <span class="md-ellipsis"> 磁盘分区工具 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/fastdeletfiles/"> <span class="md-ellipsis"> 系统空间清理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/nospace-device/"> <span class="md-ellipsis"> 无空间设备处理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_9" type="checkbox"/> <label class="md-nav__link" for="__nav_5_9" id="__nav_5_9_label" tabindex=""> <span class="md-ellipsis"> 网络与协议分析 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_9_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_9"> <span class="md-nav__icon md-icon"></span> 网络与协议分析 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/tcpdump/"> <span class="md-ellipsis"> 网络抓包分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/iperf/"> <span class="md-ellipsis"> 网络诊断工具 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/last/"> <span class="md-ellipsis"> 网络状态监控 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/wget/"> <span class="md-ellipsis"> 下载工具wget </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/stat/"> <span class="md-ellipsis"> 系统资源统计 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_10" type="checkbox"/> <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex=""> <span class="md-ellipsis"> 数据恢复与备份 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_10_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_10"> <span class="md-nav__icon md-icon"></span> 数据恢复与备份 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/ddrescue/"> <span class="md-ellipsis"> 数据恢复ddrescue </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/fio/"> <span class="md-ellipsis"> 磁盘性能测试fio </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/vm-config/"> <span class="md-ellipsis"> VM性能配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/memtest/"> <span class="md-ellipsis"> 内存测试 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/patch/"> <span class="md-ellipsis"> 系统补丁管理 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_11" type="checkbox"/> <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex=""> <span class="md-ellipsis"> 调试与性能分析 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_11_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_11"> <span class="md-nav__icon md-icon"></span> 调试与性能分析 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/perf/"> <span class="md-ellipsis"> 性能分析工具perf </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/pmap/"> <span class="md-ellipsis"> 内存映射分析pmap </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/pstack_strace/"> <span class="md-ellipsis"> 进程调试 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/so/"> <span class="md-ellipsis"> 符号表与共享库 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/cgroups/"> <span class="md-ellipsis"> 硬件驱动分析 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_12" type="checkbox"/> <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex=""> <span class="md-ellipsis"> 安全增强工具 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_12_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_12"> <span class="md-nav__icon md-icon"></span> 安全增强工具 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/elfutil/"> <span class="md-ellipsis"> ELF工具详解 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/pid_m/"> <span class="md-ellipsis"> 调试堆栈分析 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/lang/"> <span class="md-ellipsis"> 软件包语言配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5_13" type="checkbox"/> <label class="md-nav__link" for="__nav_5_13" id="__nav_5_13_label" tabindex=""> <span class="md-ellipsis"> 系统维护与问题解决 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_13_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_5_13"> <span class="md-nav__icon md-icon"></span> 系统维护与问题解决 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/lightdm/"> <span class="md-ellipsis"> 轻量桌面管理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/4k-wa/"> <span class="md-ellipsis"> 硬盘4K对齐 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/repo/"> <span class="md-ellipsis"> 仓库远程配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/git-sparsecheckout/"> <span class="md-ellipsis"> 版本控制优化 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/github-dns/"> <span class="md-ellipsis"> DNS优化配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/ubuntu2004-qa/"> <span class="md-ellipsis"> Ubuntu2004常见问题 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/git-objects-clean/"> <span class="md-ellipsis"> Git对象清理 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/xz/"> <span class="md-ellipsis"> 归档压缩 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../linux/frp/"> <span class="md-ellipsis"> 便捷连接工具 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/> <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex=""> <span class="md-ellipsis"> 数据库思考 </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_6"> <span class="md-nav__icon md-icon"></span> 数据库思考 </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/maintenance/thinking_in_db_fd/"> <span class="md-ellipsis"> 结构设计 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/thinking_in_db_performance/"> <span class="md-ellipsis"> 性能优化 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../postgres/performance/thinking_in_db_tune/"> <span class="md-ellipsis"> 模块调优 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#_1"> <span class="md-ellipsis"> 概述 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_2"> <span class="md-ellipsis"> 架构组件 </span> </a> <nav aria-label="架构组件" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_3"> <span class="md-ellipsis"> 数据流图 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_4"> <span class="md-ellipsis"> 构建分片集群 </span> </a> <nav aria-label="构建分片集群" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_5"> <span class="md-ellipsis"> 单机构建最小实验环境 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_6"> <span class="md-ellipsis"> 端口规划 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_7"> <span class="md-ellipsis"> 配置文件 </span> </a> <nav aria-label="配置文件" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_8"> <span class="md-ellipsis"> 配置服务器配置文件 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#shardsvr"> <span class="md-ellipsis"> 分片副本集 (shardsvr) 配置文件 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_9"> <span class="md-ellipsis"> 目录规划 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_10"> <span class="md-ellipsis"> 通信认证文件 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_11"> <span class="md-ellipsis"> 启动服务并初始化 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#mongos"> <span class="md-ellipsis"> mongos </span> </a> <nav aria-label="mongos" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_12"> <span class="md-ellipsis"> 配置 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_13"> <span class="md-ellipsis"> 启动 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#mongos_1"> <span class="md-ellipsis"> 通过mongos配置集群 </span> </a> <nav aria-label="通过mongos配置集群" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_14"> <span class="md-ellipsis"> 配置分片集群 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_15"> <span class="md-ellipsis"> 启用数据库分片 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_16"> <span class="md-ellipsis"> 验证 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_17"> <span class="md-ellipsis"> 应用连接分片集群 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_18"> <span class="md-ellipsis"> 分片策略 </span> </a> <nav aria-label="分片策略" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_19"> <span class="md-ellipsis"> 块范围分片 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#hash"> <span class="md-ellipsis"> Hash 分片 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#zone"> <span class="md-ellipsis"> Zone 分片 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_20"> <span class="md-ellipsis"> 分片键选择 </span> </a> <nav aria-label="分片键选择" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_21"> <span class="md-ellipsis"> 好的分片键特征 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_22"> <span class="md-ellipsis"> 复合分片键 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_23"> <span class="md-ellipsis"> 管理分片集群 </span> </a> <nav aria-label="管理分片集群" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_24"> <span class="md-ellipsis"> 检查分片状态 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_25"> <span class="md-ellipsis"> 增加分片 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_26"> <span class="md-ellipsis"> 监控与调优 </span> </a> <nav aria-label="监控与调优" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_27"> <span class="md-ellipsis"> 关键指标 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_28"> <span class="md-ellipsis"> 分片操作查询 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_29"> <span class="md-ellipsis"> 注意事项 </span> </a> <nav aria-label="注意事项" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#_30"> <span class="md-ellipsis"> 分区倾斜解决方法 </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_31"> <span class="md-ellipsis"> 限制说明 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#_32"> <span class="md-ellipsis"> 最佳实践 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="mongodb">MongoDB 分片集群</h1> <h2 id="_1">概述</h2> <p>MongoDB 分片 (Sharding) 是一种跨多台机器分布数据的方法。 MongoDB 使用分片将大型数据集分布在多个服务器或服务器群集上，以提高数据处理能力和存储容量。</p> <ul> <li>存储瓶颈： 单机磁盘容量无法容纳持续增长的数据。</li> <li>性能瓶颈： 活跃数据集超过物理内存容量，导致大量磁盘IO，读写性能下降。</li> <li>吞吐瓶颈： 单一服务器的网络和CPU处理能力无法承受高并发的读写请求</li> </ul> <h2 id="_2">架构组件</h2> <ul> <li>配置服务器（Config Servers）</li> </ul> <p>配置服务器存储集群元数据（如片键值和块映射），以及锁以同步元数据更改。</p> <ul> <li>分片（Shard）</li> </ul> <p>集群的“数据存储节点”，是实际承载数据的单元。</p> <ul> <li>mongos 查询路由器</li> </ul> <p>应用连接到 <code>mongos</code> 进程而不是直接连接到分片，它充当中间层，代表应用程序处理查询和分发操作。</p> <h3 id="_3">数据流图</h3> <div class="mermaid">graph LR
    A[客户端] --&gt;|请求| B(① mongos接收)
    B --&gt;|② 查询：&lt;br/&gt;“数据在哪？”| C[Config Servers]
    C --&gt;|③ 回复位置| B
    B --&gt;|④ 转发请求到正确分片| D{目标分片}
    D --&gt;|Shard 1| E[分片1]
    D --&gt;|Shard 2| F[分片2]
    E &amp; F --&gt;|⑤ 返回数据| B
    B --&gt;|⑥ 最终结果| A

</div> <h2 id="_4">构建分片集群</h2> <ul> <li>1个配置服务器副本集（3个成员）</li> <li>2个分片副本集（每个3个成员）</li> <li>1个mongos实例（可以多个，无状态)</li> </ul> <h3 id="_5">单机构建最小实验环境</h3> <h3 id="_6">端口规划</h3> <ul> <li>配置服务器副本集 (configsvr): 29901, 29902, 29903</li> <li>分片1副本集 (shardsvr): 29911, 29912, 29913</li> <li>分片2副本集 (shardsvr): 29921, 29922, 29923</li> <li>mongos: 29900</li> </ul> <h3 id="_7">配置文件</h3> <h4 id="_8">配置服务器配置文件</h4> <p>在用于配置服务器时，副本集的配置有以下限制：</p> <ul> <li>不能有仲裁节点。</li> <li>不得包含延迟节点。</li> <li>必须构建索引（即任何成员的 members[n].buildIndexes 设置都应为 true,默认就可以） 。</li> </ul> <p>创建第一个配置服务器配置文件 mongod-config-29901.conf：</p> <pre><code># 配置文件1 - 配置服务器成员1
systemLog:
  destination: file
  path: /data/mongodb/config1/mongod.log
  logAppend: true
storage:
  dbPath: /data/mongodb/config1/db
  journal:
    enabled: true
net:
  bindIp: 0.0.0.0
  port: 29901
replication:
  replSetName: configReplSet  # 副本集名称
sharding:
  clusterRole: configsvr  # 关键！声明为配置服务器
security:
  authorization: enabled
  keyFile: /data/mongodb/shared/keyfile  # 集群内认证文件
processManagement:
  fork: true
  pidFilePath: /data/mongodb/config1/mongod.pid

</code></pre> <p>其他两个配置服务器类似，只需修改： path, dbPath, port, pidFilePath 中的端口号</p> <h4 id="shardsvr">分片副本集 (shardsvr) 配置文件</h4> <p>创建分片1第一个成员配置文件 mongod-shard1-29911.conf：</p> <pre><code># 分片1成员1配置文件
systemLog:
  destination: file
  path: /data/mongodb/shard1_1/mongod.log
  logAppend: true
storage:
  dbPath: /data/mongodb/shard1_1/db
net:
  bindIp: 0.0.0.0
  port: 29911
replication:
  replSetName: shard1ReplSet  # 分片1副本集名称
sharding:
  clusterRole: shardsvr  # 关键！声明为分片服务器
security:
  authorization: enabled
  keyFile: /data/mongodb/shared/keyfile
processManagement:
  fork: true
  pidFilePath: /data/mongodb/shard1_1/mongod.pid

</code></pre> <p>注意：分片2的配置文件类似，但 replication.replSetName 改为 shard2ReplSet，端口改为2992x系列。</p> <h3 id="_9">目录规划</h3> <pre><code>mkdir -p /data/mongodb/{config1,config2,config3,shard1_1,shard1_2,shard1_3,shard2_1,shard2_2,shard2_3,mongos}/db
</code></pre> <h3 id="_10">通信认证文件</h3> <pre><code># 生成keyfile
mkdir -p /data/mongodb/shared
openssl rand -base64 756 &gt; /data/mongodb/shared/keyfile
chmod 400 /data/mongodb/shared/keyfile
# 确保所有mongod进程用户有读取权限
</code></pre> <h3 id="_11">启动服务并初始化</h3> <p>配置服务器</p> <pre><code># 启动三个配置服务器
mongod -f mongod-config-29901.conf
mongod -f mongod-config-29902.conf
mongod -f mongod-config-29903.conf

# 连接任意一个初始化副本集
mongosh --port 29901
// 初始化配置服务器副本集
rs.initiate(
  {
    _id: "configReplSet",
    configsvr: true,  // 这里也要指定configsvr
    members: [
      { _id: 0, host: "localhost:29901" },
      { _id: 1, host: "localhost:29902" },
      { _id: 2, host: "localhost:29903" }
    ]
  }
)

// 等待选举完成
rs.status()
</code></pre> <p>创建一个超级用户</p> <pre><code>// 切换到admin数据库
use admin
// 创建超级管理员用户（这里用户名/密码简单，生产环境要用强密码）
db.createUser({
  user: "admin",
  pwd: "admin123",
  roles: [
    { role: "root", db: "admin" },
    { role: "clusterAdmin", db: "admin" },
    { role: "userAdminAnyDatabase", db: "admin" }
  ]
})
</code></pre> <p>分片副本集1服务器</p> <pre><code># 启动分片1的三个成员
mongod -f mongod-shard1-29911.conf
mongod -f mongod-shard1-29912.conf
mongod -f mongod-shard1-29913.conf

# 连接初始化
mongosh --port 29911
// 初始化分片1副本集
rs.initiate(
  {
    _id: "shard1ReplSet",
    members: [
      { _id: 0, host: "localhost:29911" },
      { _id: 1, host: "localhost:29912" },
      { _id: 2, host: "localhost:29913" }
    ]
  }
)

rs.status()
</code></pre> <p>分片副本集2服务器</p> <pre><code># 启动分片1的三个成员
mongod -f mongod-shard2-29921.conf
mongod -f mongod-shard2-29922.conf
mongod -f mongod-shard2-29923.conf

# 连接初始化
mongosh --port 29921
// 初始化分片1副本集
rs.initiate(
  {
    _id: "shard2ReplSet",
    members: [
      { _id: 0, host: "localhost:29921" },
      { _id: 1, host: "localhost:29922" },
      { _id: 2, host: "localhost:29923" }
    ]
  }
)

rs.status()
</code></pre> <p>到此副本集已经全部准备完毕!</p> <h3 id="mongos">mongos</h3> <h4 id="_12">配置</h4> <p>创建mongos配置文件 mongos-29900.conf：</p> <pre><code># mongos配置文件
systemLog:
  destination: file
  path: /data/mongodb/mongos/mongos.log  # 注意是mongos.log，不是mongod.log
  logAppend: true
net:
  bindIp: 0.0.0.0
  port: 29900
sharding:
  configDB: configReplSet/localhost:29901,localhost:29902,localhost:29903
security:
  keyFile: /data/mongodb/shared/keyfile
processManagement:
  fork: true
  pidFilePath: /data/mongodb/mongos/mongos.pid
</code></pre> <h4 id="_13">启动</h4> <pre><code>mongos -f mongos-29900.conf
</code></pre> <h3 id="mongos_1">通过mongos配置集群</h3> <h4 id="_14">配置分片集群</h4> <pre><code>// 连接到mongosh
mongosh --port 29900 -u admin -p admin123 --authenticationDatabase admin
或
mongosh --port 29900
use admin
db.auth("admin", "admin123")
// 添加分片1
sh.addShard("shard1ReplSet/localhost:29911,localhost:29912,localhost:29913")
// 添加分片2
sh.addShard("shard2ReplSet/localhost:29921,localhost:29922,localhost:29923")
// 查看分片信息
db.shards.find()
// 查看分片状态
sh.status()
</code></pre> <h4 id="_15">启用数据库分片</h4> <p>假设我们要对数据库myapp分片）：</p> <pre><code>// 切换到目标数据库或指定数据库名
use myapp
// 启用该数据库的分片功能
// 创建索引（必须先在分片键上创建索引）
db.users.createIndex({ "user_id": 1 })
// 对集合进行分片 , 支持两种分片方式 范围分片和hash分片
基于范围的分片可以使用多个字段作为分片键，并将数据划分为由分片键值确定的连续范围。
sh.shardCollection("myapp.users", { "user_id": 1 })
// 哈希分片使用单个字段的哈希索引作为分片键，在分片集群中对数据进行分区。
// sh.shardCollection("myapp.users", { "user_id": "hashed" })
</code></pre> <p>分片键注意事项</p> <p>您选择的分片键会影响分片效率，以及您利用某些分片功能（例如区域）的能力。</p> <p>mongosh 提供了方法 <code>convertShardKeyToHashed()</code>。此方法使用与哈希索引相同的哈希函数，且可用于查看某一键的哈希值。</p> <h4 id="_16">验证</h4> <pre><code>// 查看详细集群状态
sh.status()  // 显示所有分片、数据库、集合、块分布等信息

// 查看集合的分片分布
db.users.getShardDistribution()

// 查看配置信息
db.getSiblingDB("config").shards.find()
db.getSiblingDB("config").databases.find()
db.getSiblingDB("config").collections.find()
</code></pre> <h3 id="_17">应用连接分片集群</h3> <pre><code>const uri = "mongodb://localhost:29900/myapp?replicaSet=不是必需的&amp;directConnection=false";
// 注意：连接的是mongos，多个mongos可以用逗号分隔
const uri = "mongodb://admin:admin123@mongos1:29900,mongos2:29900/myapp?authSource=admin&amp;replicaSet=notRequired";
</code></pre> <h2 id="_18">分片策略</h2> <h3 id="_19">块范围分片</h3> <ul> <li>数据根据分片键值的范围分割</li> <li>使用 <code>_id</code>、数字或时间戳字段时常用</li> <li>分布不均可能导致热点问题</li> </ul> <h3 id="hash">Hash 分片</h3> <ul> <li>对片键进行 Hash 运算，实现更均匀分布</li> <li>更适合随机分发数据</li> <li>不支持范围查询优化</li> </ul> <h3 id="zone">Zone 分片</h3> <ul> <li>将数据分发到定义的区域(zone)</li> <li>每个 zone 包含一或多一分片</li> <li>提高读写操作性能</li> </ul> <h2 id="_20">分片键选择</h2> <h3 id="_21">好的分片键特征</h3> <ul> <li>足够基数以支持数据分发</li> <li>排除低基数字段（如性别）</li> <li>避免单调字段（时间戳）防止热点</li> <li>查询模式匹配</li> </ul> <h3 id="_22">复合分片键</h3> <pre><code class="language-javascript">// 创建复合分片键
sh.shardCollection("users", { userId: 1, region: 1 });

// 顺序很重要，第一个键决定块边界
</code></pre> <h2 id="_23">管理分片集群</h2> <h3 id="_24">检查分片状态</h3> <pre><code class="language-javascript">// 显示集群状态
sh.status();

// 显示分片信息
db.printShardingStatus();

// 查看集合分片统计
db.collection.stats();
</code></pre> <h3 id="_25">增加分片</h3> <pre><code class="language-bash"># 添加新分片
sh.addShard("new-shard-host:27018")

# 检查分片列表
sh.getShardList()
</code></pre> <h2 id="_26">监控与调优</h2> <h3 id="_27">关键指标</h3> <ul> <li>集群 CPU 使用率</li> <li>内存使用情况</li> <li>磁盘 I/O</li> <li>网络延迟</li> <li>平衡状态</li> </ul> <h3 id="_28">分片操作查询</h3> <pre><code class="language-javascript">// 查询命中单一分片（最优）
db.orders.find({ userId: ObjectId("...") });

// 查询需要路由到多个分片
db.orders.find({ category: "Electronics" });
</code></pre> <h2 id="_29">注意事项</h2> <h3 id="_30">分区倾斜解决方法</h3> <ol> <li>检查分片键分布</li> <li>考虑重新分片策略</li> <li>使用 Zone Sharding</li> </ol> <h3 id="_31">限制说明</h3> <ul> <li>分片键一旦设置无法修改</li> <li>不能在已分片的集合上设置分片键</li> <li>分片仅支持单个集合的唯一索引</li> </ul> <h2 id="_32">最佳实践</h2> <ol> <li>启动分片前进行压力测试</li> <li>监控块分配情况</li> <li>计划停机窗口维护平衡</li> <li>正确选择分片键减少数据迁移</li> <li>使用复制集作为分片确保高可用</li> </ol> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button class="md-top md-icon" data-md-component="top" hidden="" type="button"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </button> </main> <footer class="md-footer"> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> <div class="md-copyright__highlight"> Copyright © 2026 | Eamon </div> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <div class="md-progress" data-md-component="progress" role="progressbar"></div> <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script> <script src="../../custom-js/custom-js.js"></script> <script src="../../redirect-md.js"></script> <script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body> </html>