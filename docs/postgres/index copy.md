# ğŸ˜ PostgreSQL ä¸“ä¸šæ–‡æ¡£ä¸­å¿ƒ

æ¬¢è¿æ¥åˆ° PostgreSQL ä¸“ä¸šæ–‡æ¡£ä¸­å¿ƒã€‚è¿™é‡Œæ±‡èšäº† PostgreSQL æ•°æ®åº“çš„å…¨æ–¹ä½æŠ€æœ¯æ–‡æ¡£ï¼ŒåŠ©æ‚¨æ·±å…¥äº†è§£è¿™æ¬¾å¼ºå¤§è€Œå¯é çš„å¼€æºå¯¹è±¡å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿã€‚

## å¿«é€Ÿå¯¼èˆª

å€ŸåŠ© MkDocs Material çš„ `grid cards` æ’ä»¶ï¼Œæˆ‘ä»¬æä¾›äº†ä¾¿æ·çš„åŠŸèƒ½å…¥å£ã€‚

<div class="grid cards" markdown>

- {: data-title="Installation" } **å®‰è£…ä¸é…ç½®**

  ***

  è¯¦ç»†äº†è§£ PostgreSQL çš„å®‰è£…éƒ¨ç½²å’Œæ€§èƒ½é…ç½®æ–¹æ³•ã€‚
  {:.annotate}

  1.  [è¯¦æƒ…é“¾æ¥](./install/install01.md){: .annotate target="\_blank" }

- {: data-title="Security" } **å®‰å…¨ç®¡ç†**

  ***

  æŒæ¡ PostgreSQL ä¸­çš„ç”¨æˆ·æƒé™å’Œå®‰å…¨è®¤è¯ç­–ç•¥ã€‚
  {:.annotate}

  1.  [è¯¦æƒ…é“¾æ¥](./security/role-manager.md){: .annotate target="\_blank" }

- {: data-title="Optimization" } **ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–**

  ***

  ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•è®¾è®¡å’ŒæŸ¥è¯¢æ€§èƒ½æå‡æŠ€æœ¯ã€‚
  {:.annotate}

  1.  [è¯¦æƒ…é“¾æ¥](./index/index01.md){: .annotate target="\_blank" }

- {: data-title="Performance" } **æ€§èƒ½ä¼˜åŒ–**

  ***

  å…¨é¢çš„æ•°æ®åº“æ€§èƒ½åˆ†æä¸è°ƒä¼˜æ–¹æ³•è®ºã€‚
  {:.annotate}

  1.  [è¯¦æƒ…é“¾æ¥](./performance/params.md){: .annotate target="\_blank" }

- {: data-title="Replication" } **æ•°æ®åŒæ­¥**

  ***

  æ·±å…¥ç†è§£æµå¤åˆ¶ã€é€»è¾‘å¤åˆ¶ç­‰æ•°æ®åŒæ­¥æœºåˆ¶ã€‚
  {:.annotate}

  1.  [è¯¦æƒ…é“¾æ¥](./replication/replication01.md){: .annotate target="\_blank" }

- {: data-title="Backup" } **å¤‡ä»½ä¸æ¢å¤**

  ***

  ä¿éšœæ•°æ®å®‰å…¨çš„å¤‡ä»½ç­–ç•¥ä¸æ¢å¤æŠ€æœ¯è¯¦è§£ã€‚
  {:.annotate}

  1.  [è¯¦æƒ…é“¾æ¥](./backup/index.md){: .annotate target="\_blank" }

- {: data-title="HA" } **é«˜å¯ç”¨æ–¹æ¡ˆ**

  ***

  å®ç°ä¸šåŠ¡è¿ç»­æ€§çš„ HA è§£å†³æ–¹æ¡ˆå’ŒæŠ€æœ¯é€‰å‹ã€‚
  {:.annotate}

  1.  [è¯¦æƒ…é“¾æ¥](./ha/patroni.md){: .annotate target="\_blank" }

- {: data-title="Maintenance" } **ç»´æŠ¤ç®¡ç†**

  ***

  æ•°æ®åº“æ—¥å¸¸è¿ç»´ç®¡ç†å’Œç»´æŠ¤ä»»åŠ¡å¤„ç†ã€‚
  {:.annotate}

  1.  [è¯¦æƒ…é“¾æ¥](./install/daily_management.md){: .annotate target="\_blank" }

</div>

## PostgreSQL ç®€ä»‹

PostgreSQL æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å¼€æºå¯¹è±¡å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿï¼Œå…·æœ‰å¯é æ€§ã€ç¨³å®šæ€§å’Œæ•°æ®å®Œæ•´æ€§æ–¹é¢çš„å“è¶Šè¡¨ç°ã€‚å®ƒæ‹¥æœ‰è¶…è¿‡ 35 å¹´çš„å¼€å‘å†å²ï¼Œåœ¨ ACID åˆè§„æ€§ã€å¯æ‰©å±•æ€§ã€å¤æ‚æŸ¥è¯¢å¤„ç†ç­‰æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **å¼€æºå…è´¹**ï¼šBSD è®¸å¯åè®®ï¼Œæ— å‚å•†é”å®šé£é™©
- **æ ‡å‡†å…¼å®¹**ï¼šä¸¥æ ¼éµå¾ª SQL æ ‡å‡†ï¼Œæ”¯æŒé«˜çº§ç‰¹æ€§
- **æ‰©å±•æ€§ä½³**ï¼šæ”¯æŒè‡ªå®šä¹‰å‡½æ•°ã€æ“ä½œç¬¦ã€æ•°æ®ç±»å‹
- **æ•°æ®å®Œæ•´æ€§**ï¼šä¸¥æ ¼çš„çº¦æŸæ£€æŸ¥å’Œæ•°æ®ç±»å‹éªŒè¯
- **å¹¶å‘å¤„ç†**ï¼šå…ˆè¿›çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCC)
- **è·¨å¹³å°æ”¯æŒ**ï¼šæ”¯æŒæ‰€æœ‰ä¸»æµæ“ä½œç³»ç»Ÿå¹³å°

### ä¼ä¸šåº”ç”¨åœºæ™¯

- âœ… **é‡‘èæ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿ**
- âœ… **ç”µå•†å¹³å°è®¢å•å¤„ç†**
- âœ… **æ•°æ®åˆ†æä¸å•†ä¸šæ™ºèƒ½**
- âœ… **åœ°ç†ä½ç½®åº”ç”¨(Geospatial)**
- âœ… **å…¨æ–‡æœç´¢åŠŸèƒ½**
- âœ… **JSON/XML åŠç»“æ„åŒ–æ•°æ®**

## æŠ€æœ¯è§„æ ¼å¯¹æ¯”

| åŠŸèƒ½              | PostgreSQL | MySQL | Oracle | SQL Server |
| ----------------- | ---------- | ----- | ------ | ---------- |
| ä¸¥æ ¼ SQL æ ‡å‡†å…¼å®¹ | âœ…         | âŒ    | âš ï¸     | âš ï¸         |
| JSON å¤„ç†èƒ½åŠ›     | ğŸŒŸ         | ğŸŒŸ    | âŒ     | âš ï¸         |
| GIS ç©ºé—´è®¡ç®—      | ğŸŒŸ         | âš ï¸    | ğŸŒŸ     | âš ï¸         |
| å¹¶å‘å¤„ç†æ€§èƒ½      | ğŸŒŸ         | ğŸŒŸ    | âœ…     | âœ…         |
| æ— æˆæœ¬å•†ç”¨        | âœ…         | âš ï¸    | âŒ     | âŒ         |
| MVCC æ”¯æŒ         | âœ…         | âš ï¸    | âœ…     | âœ…         |

??? info "å›¾æ ‡è¯´æ˜"
ğŸŒŸ å“è¶Šçº§ &nbsp;&nbsp; âœ… ä¼˜ç§€çº§ &nbsp;&nbsp; âš ï¸ ä¸­ç­‰çº§ &nbsp;&nbsp; âŒ è¾ƒå¼±çº§

## ä½•æ—¶ä½¿ç”¨ PostgreSQLï¼Ÿ

### æ¨èé€‰ç”¨åœºæ™¯

#### 1. å¤æ‚æŸ¥è¯¢éœ€æ±‚

- éœ€è¦å¤æ‚çš„ JOIN æŸ¥è¯¢å’Œèšåˆè¿ç®—
- æ•°æ®åˆ†æã€æŠ¥è¡¨ç”Ÿæˆã€å•†ä¸šæ™ºèƒ½åœºæ™¯
- åœ°ç†ä¿¡æ¯ç³»ç»Ÿã€ç©ºé—´æ•°æ®å¤„ç†éœ€æ±‚

#### 2. ä¸¥æ ¼æ•°æ®ä¸€è‡´æ€§è¦æ±‚

- é‡‘èã€æ”¯ä»˜ã€è´¦åŠ¡ç­‰å…³é”®ä¸šåŠ¡ç³»ç»Ÿ
- å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚æé«˜çš„åº”ç”¨
- å¼ºäº‹åŠ¡æ€§ã€é«˜éš”ç¦»æ€§çš„ä¸šåŠ¡é€»è¾‘

#### 3. æŠ€æœ¯åˆ›æ–°æ‹“å±•

- éœ€è¦ä½¿ç”¨ JSONB ç­‰éç»“æ„åŒ–æ•°æ®ç±»å‹
- è‡ªå®šä¹‰å‡½æ•°ã€æ•°æ®ç±»å‹å’Œè¿ç®—ç¬¦
- ç¬¬ä¸‰æ–¹æ‰©å±•å’Œè‡ªå®šä¹‰åŠŸèƒ½å¼€å‘

#### 4. å•†ä¸šæˆæƒæˆæœ¬è€ƒè™‘

- é¢„ç®—å—é™ä½†éœ€è¦ä¼ä¸šçº§åŠŸèƒ½çš„é¡¹ç›®
- ä¸å¸Œæœ›å—åˆ°å•†ä¸šè½¯ä»¶ä¾›åº”å•†é”å®šçš„åœºæ™¯

### å¯è€ƒè™‘æ›¿ä»£çš„æƒ…å†µ

- æç«¯è¯»å†™é€Ÿåº¦è¦æ±‚ä¸”æ•°æ®æ¨¡å‹ç®€å•ï¼ˆå¦‚çº¯é”®å€¼å­˜å‚¨ï¼‰
- å›¢é˜Ÿä¸¥é‡ä¾èµ– Oracle ç‰¹æœ‰åŠŸèƒ½ï¼Œä¸”æ—¶é—´æˆæœ¬æé«˜
- å·²å½¢æˆå®Œå–„ç”Ÿæ€ä¸”æ›¿æ¢æˆæœ¬è¿‡é«˜

## å‘å±•è¶‹åŠ¿

```mermaid
graph LR
    A[ç°ä»£æ•°æ®åº“] --> B{å‘å±•æ–¹å‘}
    B --> C[äº‘è®¡ç®—æ”¯æŒ]
    B --> D[æ··åˆäº‹åŠ¡åˆ†æ]
    B --> E[å¤šæ¨¡å‹æ•°æ®å¤„ç†]
    B --> F[AIé›†æˆèƒ½åŠ›]

    C --> G[PostgreSQL]
    D --> G
    E --> G
    F --> G

    G --> H[ä¸°å¯Œæ‰©å±•]
    H --> I[Citusåˆ†å¸ƒå¼]
    H --> J[TimescaleDBæ—¶åº]
    H --> K[PostGISåœ°ç†]
    H --> L[PGroongaå…¨æ–‡æ£€ç´¢]
```

### PostgreSQL çš„æœ€æ–°æ¼”è¿›æ–¹å‘ï¼š

- **åˆ†å¸ƒå¼èƒ½åŠ›å¢å¼º** - é€šè¿‡ Citus ç­‰æ‰©å±•æ”¯æŒå¤§è§„æ¨¡æ°´å¹³æ‰©å±•
- **äº‘åŸç”Ÿé›†æˆ** - ä¸å®¹å™¨åŒ–ã€å¾®æœåŠ¡æ¶æ„æ·±åº¦èåˆ
- **æœºå™¨å­¦ä¹ é›†æˆ** - ML ä¸ç»Ÿè®¡åˆ†æåŠŸèƒ½å†…ç½®å¢å¼º
- **æ—¶åºæ•°æ®ä¼˜åŒ–** - TimescaleDB ç­‰ä¸“æœ‰æ—¶åºæ‰©å±•
- **å›¾æ•°æ®å¤„ç†** - ä¸°å¯Œçš„å›¾æ•°æ®åº“åŠŸèƒ½æ”¯æŒ

## ç‰ˆæœ¬è§„åˆ’

| ç‰ˆæœ¬              | å‘å¸ƒæ—¶é—´ | æ”¯æŒæœŸé™ | ä¸»è¦ç‰¹æ€§                     |
| ----------------- | -------- | -------- | ---------------------------- |
| **PostgreSQL 12** | 2019     | 2024 å¹´  | SQL æ ‡å‡†å¢å¼ºã€PL/pgSQL ä¼˜åŒ–  |
| **PostgreSQL 13** | 2020     | 2025 å¹´  | æŸ¥è¯¢ä¼˜åŒ–å™¨æ”¹è¿›ã€ç´¢å¼•æ€§èƒ½æå‡ |
| **PostgreSQL 14** | 2021     | 2026 å¹´  | å¹¶è¡ŒæŸ¥è¯¢ã€é€»è¾‘å¤åˆ¶å¢å¼º       |
| **PostgreSQL 15** | 2022     | 2027 å¹´  | åˆ†åŒºè¡¨åŠŸèƒ½å¢å¼ºã€æ€§èƒ½æå‡     |
| **PostgreSQL 16** | 2023     | 2028 å¹´  | å¹¶è¡Œå¤„ç†å¢å¼ºã€å®‰å…¨æ€§åŠ å¼º     |

**æœ€æ–°æ¨èç‰ˆæœ¬**ï¼š`PostgreSQL 15`, `PostgreSQL 14 LTS`

## æœ€ä½³å®è·µ

### æ€§èƒ½ä¼˜åŒ–é»„é‡‘æ³•åˆ™

1. **ç´¢å¼•è®¾è®¡ç­–ç•¥**

   - ç†è§£ B-treeã€Hashã€GINã€GiST ä¸åŒç´¢å¼•é€‚ç”¨åœºæ™¯
   - ä¼˜å…ˆè¦†ç›–æœ€é¢‘ç¹çš„æŸ¥è¯¢æ¡ä»¶
   - å…³æ³¨éƒ¨åˆ†ç´¢å¼•ä¸è¡¨è¾¾å¼ç´¢å¼•çš„åº”ç”¨

2. **è¡¨åˆ†åŒºè§„åˆ’**

   - åˆç†åˆ©ç”¨èŒƒå›´åˆ†åŒºã€åˆ—è¡¨åˆ†åŒºæé«˜æŸ¥è¯¢æ•ˆç‡
   - è€ƒè™‘æ—¶é—´ç»´åº¦æ•°æ®å†·çƒ­åˆ†ç¦»ç­–ç•¥
   - æ³¨æ„åˆ†åŒºå‰ªæå¯¹æ€§èƒ½çš„å½±å“

3. **æŸ¥è¯¢ç¼–å†™æŠ€å·§**
   - é¿å… SELECT \*ä½¿ç”¨ï¼ŒæŒ‡å®šæ˜ç¡®å­—æ®µ
   - æ­£ç¡®ä½¿ç”¨ JOIN å’Œå­æŸ¥è¯¢ï¼Œé¿å…ç¬›å¡å°”ç§¯
   - å……åˆ†åˆ©ç”¨çª—å£å‡½æ•°å®Œæˆå¤æ‚ç»Ÿè®¡

### å®‰å…¨é…ç½®è¦ç‚¹

1. **ç”¨æˆ·æƒé™ç®¡ç†**

   - å®æ–½æœ€å°æƒé™åŸåˆ™
   - æ­£ç¡®é…ç½® row-level security(RLS)
   - åŒºåˆ†è§’è‰²ç±»å‹ä¸ç”¨é€”æƒé™æ§åˆ¶

2. **è¿æ¥è®¤è¯ç­–ç•¥**
   - åˆç†è®¾ç½® pg_hba.conf å®‰å…¨è®¤è¯è§„åˆ™
   - é…ç½® SSL åŠ å¯†ä¼ è¾“æ•æ„Ÿæ•°æ®
   - è€ƒè™‘ç¬¬ä¸‰æ–¹è®¤è¯åç«¯é›†æˆæ–¹æ¡ˆ

> â­ é¢„çŸ¥æ›´å¤šå®è·µç»†èŠ‚ï¼Œå¯å‚è€ƒå·¦ä¾§èœå•ä¸­å¯¹åº”ä¸“é¢˜ç« èŠ‚
